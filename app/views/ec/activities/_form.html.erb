<%= form_for @activity, url: @activity.new_record? ? ec_activities_path : ec_activity_path(@activity), validate: true, html: {id: 'ec_activity_form'} do |f| %>
  <div class="modal-body">
    <div class="form-group">
      <label class="control-label">活动名称<span class="required-star">*</span></label>
      <div class="clearfix">
        <%= f.text_field :title, class: "col-md-12"%>
      </div>
    </div>
    <div class="form-group">
      <label style="position: relative;" class="control-label">图片<span class="help-inline text-warning line-height-32">建议图片尺寸：200*200</span>
        <a id="clearpic" class="btn btn-default btn-sm margin-left-20" href="javascript:;">删除</a>
      </label>
      <div class="clearfix">
        <div id="pic" data-key="<%= @activity.pic_key %>" data-name="ec_activity[pic_key]" data-img="<%= @activity.pic_url %>" data-height="100" data-width="100" data-type="0" class="cieldon-file pull-left width-100px cieldon-file-0"></div>
      </div>
    </div>
    <div class="form-group">
      <label class="control-label">活动摘要<span class="required-star">*</span></label>
      <div class="clearfix">
        <%= f.text_area :summary, rows: 3, class: "col-md-8"%>
      </div>
    </div>
    <div class="form-group">
      <label class="control-label">设置活动商品<span class="required-star">*</span></label>
      <div class="clearfix">
        <%= f.select :ec_product_id, EcProduct.pluck(:name, :id),class: "form-control"%>
        <%= f.select :ec_item_id, EcItem.pluck(:name, :id), class: "form-control"%>
      </div>
    </div>
    <div class="clearfix"></div>
    <div class="form-group ">
      <%= f.submit '确定', class: 'btn btn-sm btn-primary' %>
      <%= f.button '取消', type: :reset, class: "btn btn-sm btn-default", data: { dismiss: "modals" } %>
    </div>

  </div>
<% end %>

<% content_for :custom_js do %>
  <script type="text/javascript">
    function refreshItemOptions(product_id) {
      $.ajax({
        url: "/ec/products/"+product_id+"/items",
        data: {"product_id": product_id},
        dataType: 'json',
        success: function (result) {
          var options = $("#ec_activity_ec_item_id");
          options.empty(); // remove old options

          options.append($("<option></option>").attr("value", '').text('请选择规格'));

          $.each(result, function (index, option) {
            options.append($("<option></option>")
                .attr("value", option.id).text(option.name));
          });
        }
      });
    }

    $("#ec_activity_ec_product_id").on('change', function (e) {
      var product_id = $(this).val();

      refreshItemOptions(product_id);
    });
  </script>
<% end %>