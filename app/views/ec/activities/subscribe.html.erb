<% content_for :main_content do %>
  <div class="main-content ">
    <div class="breadcrumbs" id="breadcrumbs">
      <ul class="breadcrumb">
        <%= render 'partials/home' %>
        <li><%= link_to '营销管理', ec_slides_path %></li>
        <li><%= link_to '营销活动', subscribe_ec_activities_path %></li>
      </ul>
      <%#= render '/layouts/qrcode' %>
    </div>

    <div class="page-content">
      <div class="row">
        <div class="tabbable">
          <ul class="nav nav-tabs padding-24 tab-size-bigger">
            <li class="active">
              <%= link_to '关注活动', subscribe_ec_activities_path %>
            </li>
          </ul>
          <div class="tab-content no-border padding-24">
            <div id="tab-1" class="tab-pane fade active in">
              <div class="row">
                <div class="col-xs-12 ">
                  <div id="tab-1" class="tab-pane fade active in">
                    <div class="row">
                      <%= form_for @activity, validate: true, :html => {:class => "form col-xs-12"} do |f| %>
                        <%= render "weixin_preview", wx_title: @activity.title || '标题', wx_summary: @activity.summary || '描述', wx_pic: (@activity.pic_url.blank? ? '/assets/activity_pics/11.jpg' : @activity.pic_url) %>

                        <div class="col-xs-12 col-md-6 col-lg-7">
                          <div class="form-group">
                            <label class="control-label">微信消息标题<span class="required-star">*</span><span class="icon-question-sign" data-rel="popover" data-trigger="hover" data-placement="right" data-content="推送关注消息后返回的微信消息标题，不能超过64个字" data-original-title="" title=""> </span></label>

                            <div class="clearfix">
                              <%= f.text_field :title, value: @activity.title, class: "col-xs-6 js-copy" %>
                            </div>
                          </div>

                          <div class="form-group">
                            <label class="control-label">微信消息图片<span class="icon-question-sign" data-rel="popover" data-trigger="hover" data-placement="right" data-content="推送关注消息返回的微信消息图片" data-original-title="" title=""></span></label>
                            <div class="clearfix">
                              <div data-name="ec_activity[pic_key]" data-img="<%= @activity.pic_url %>" data-key="<%= @activity.pic_key || "" %>" class="cieldon-file width-100px" data-type="1" data-div="#img-1" data-height="200"></div>
                              <small class="help-inline text-warning line-height-30">图片建议尺寸：720像素*400像素</small>
                            </div>
                          </div>

                          <div class="form-group">
                            <label class="control-label">微信消息摘要<span class="icon-question-sign" data-rel="popover" data-trigger="hover" data-placement="right" data-content="推送关注消息后返回的微信消息摘要" data-original-title="" title=""></span></label>

                            <div class="clearfix">
                              <%= f.text_area :summary, value: @activity.summary, rows: 5, maxlength: 255, placeholder: "不能超过255个字", class: "form-control js-copy-des" %>
                            </div>
                          </div>

                          <div class="form-group">
                            <label class="control-label">赠送礼品<span class="required-star">*</span><span class="icon-question-sign" data-rel="popover" data-trigger="hover" data-placement="right" data-content="微信用户关注公众号后赠送的礼品" data-original-title="" title=""> </span></label>

                            <div class="clearfix">
                              <%= f.select :ec_item_id, EcItem.gift.onshelf.map{|item| [[item.ec_product.name, item.name].join(' '), item.id] }, class: "form-control"%>
                            </div>
                          </div>

                          <div class="form-group">
                            <label class="control-label">礼品提示文字<span class="icon-question-sign" data-rel="popover" data-trigger="hover" data-placement="right" data-content="购物车礼品提示文字" data-original-title="" title=""></span></label>

                            <div class="clearfix">
                              <%= f.text_field :notice, value: @activity.notice || "此商品为活动赠品，xx天有效", maxlength: 255, placeholder: "此商品为活动赠品，xx天有效", class: "form-control js-copy-des" %>
                            </div>
                          </div>

                          <div class="form-group">
                            <div class="clearfix">
                              <label>
                                <%= f.check_box :is_now_order, class: 'ace' %>
                                <span class="lbl">当天能否下单</span>
                              </label>
                            </div>
                          </div>

                          <div class="form-group">
                            <label class="control-label">礼品有效期(单位：天)<span class="required-star">*</span><span class="icon-question-sign" data-rel="popover" data-trigger="hover" data-placement="right" data-content="礼品有效期天数,超过不可下单" data-original-title="" title=""> </span></label>

                            <div class="clearfix">
                              <%= f.text_field :expires_in, value: @activity.expires_in || 60, class: "col-xs-6 js-copy" %>
                            </div>
                          </div>

                          <div class="form-group">
                            <label class="control-label">测试白名单<span class="icon-question-sign" data-rel="popover" data-trigger="hover" data-placement="right" data-content="微信用户openid，多个换行添加" data-original-title="" title=""></span></label>

                            <div class="clearfix">
                              <%= f.text_area :openids, value: @activity.openids, rows: 5, maxlength: 255, placeholder: "不能超过255个字", class: "form-control js-copy-des" %>
                            </div>
                          </div>

                          <div class="form-group">
                            <input type="submit" class="btn btn-sm btn-primary" value="保存">
                            <% if @activity.stopped? %>
                              <%= link_to '启用', start_ec_activity_path(@activity), class: 'btn btn-sm btn-info', method: :post %>
                            <%- else %>
                              <%= link_to '停用', stop_ec_activity_path(@activity), class: 'btn btn-sm btn-info', method: :post %>
                            <% end %>
                          </div>
                        </div>
                      <% end %><!-- 表单结束-->
                    </div>
                    <!-- row 结束 -->
                  </div>
                  <!-- tab 结束 -->

          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>

<% content_for :custom_js do %>
<script>
  $(function(){
    $(".js-copy").keyup(function(){
      $("#preview_title").html($(this).val());
    });
    $(".js-copy-des").keyup(function(){
      $("#preview_summary").html($(this).val());
    });
  });
</script>
<% end %>
