<% content_for :main_content do %>
  <div class="main-content ">
    <div class="breadcrumbs" id="breadcrumbs">
      <ul class="breadcrumb">
        <%= render 'partials/home' %>
        <li><%= link_to '订单管理', ec_orders_path %></li>
      </ul>
      <%#= render '/layouts/qrcode' %>
    </div>

    <div class="page-content">
      <div class="tabbabled">
        <%= render "ec/order_rules/top_tab" %>

        <div class="row margin-top-20">
          <%= form_for @search, url: ec_orders_path,  html: { method: :get } do |f| %>
            <div class=" col-md-12 ">
              <div class="col-md-2">
                <div class="input-group input-group-sm input-group-text">
                  <%= f.text_field :order_no_like, placeholder:"订单编号", class: 'col-xs-12' %>
                </div>
              </div>

              <div class="col-md-2">
                <div class="input-group input-group-sm input-group-text">
                  <%= f.text_field :username_or_mobile_like, placeholder:"收货人/联系电话", class: 'col-xs-12' %>
                </div>
              </div>

              <div class="col-md-2">
               <!-- <div class="input-group input-group-sm input-group-text"> -->
                <%= f.select :status_eq, EcOrder.status_options[0...-1], {include_blank:'订单状态'},class: 'col-xs-12'%>
               <!-- </div> -->
              </div>

              <div class="col-md-4">
                <div class="input-group input-group-text">
                  <span class="input-group-addon">下单日期：</span>
                  <div class="input-group input-group-sm col-xs-12 row">
                    <span class="input-group-addon">
                      <i class="icon-calendar bigger-110"></i>
                    </span>
                    <%= f.text_field :created_at_gte, value: @search.created_at_gte.try(:to_date), class: "datepicker input-sm form-control" %>
                    <span class="input-group-addon"><i class="">-</i></span>
                    <%= f.text_field :created_at_lte, value: @search.created_at_lte.try(:to_date), class: "datepicker input-sm form-control" %>
                  </div>
                </div>
              </div>

              <div class="col-md-2">
                <div class="input-group input-group-sm input-group-text">
                  <%= f.submit '查询', class: 'btn btn-sm btn-filter btn-primary' %>&nbsp;&nbsp;
                  <%= link_to '导出', ec_orders_path(:format => :xls, search: params[:search]) ,class: 'btn btn-sm btn-filter btn-primary' %>
                </div>
              </div>
            </div>
          <% end %>
        </div>

        <div class=" col-md-12 margin-top-20">
          <table id="rolesTable" class="table table-striped table-bordered table-hover dataTable">
            <thead>
              <tr>
                <th>订单编号</th>
                <th>收货人</th>
                <th>联系电话</th>
                <!-- <th>配送类型</th> -->
                <!-- <th>订单金额</th> -->
                <!-- <th>折扣金额</th> -->
                <th>支付金额</th>
                <th>下单时间</th>
                <th>支付方式</th>
                <th>支付状态</th>
                <th>订单状态</th>
                <!-- <th>物流状态</th> -->
                <!-- <th>来源</th> -->
                <th>操作</th>
              </tr>
            </thead>
            <tboday>
              <% @ec_orders.each do |ec_order| %>
                <tr>
                  <td><%= ec_order.order_no %></td>
                  <td><%= ec_order.username %></td>
                  <td><%= ec_order.mobile %></td>
                  <!-- <td><%#= ec_order.self_pickup? ? "用户自提" : ec_order.delivery_type_name %></td> -->
                  <!-- <td><%= ec_order.total_amount %></td> -->
                  <!-- <td><%= ec_order.discount %></td> -->
                  <td><%= ec_order.pay_amount %></td>
                  <td><%= ec_order.created_at %></td>
                  <td><%= ec_order.pay_type_name %></td>
                  <td><%= ec_order.pay_status_name %></td>
                  <td><%= ec_order.status_name %></td>
                  <!-- <td><%= ec_order.logistic_status_name %></td> -->
                  <!-- <td><%= ec_order.source_type_name %></td> -->
                  <td>
                    <%= link_to '详情', ec_order_path(ec_order) %>
                    <%= link_to '编辑', 'javascript:;', data: {toggle: 'modals', target: 'roleModal', title: '编辑订单', width: '', height: '550', iframe: edit_ec_order_path(ec_order)} %>

                    <%= link_to '发货', 'javascript:;', data: {toggle: 'modals', target: 'roleModal', title: '订单详情', width: '', height: '550', iframe: deliver_ec_order_path(ec_order)} if ec_order.waiting? %>
                    <%#= link_to '送达', arrived_ec_order_path(ec_order), data: {confirm: '确认已经送达给客户签收？'}, method: :put if ec_order.delivered? %>
                    <%= link_to '完成', completed_ec_order_path(ec_order), data: {confirm: '确认已完成？'}, method: :put if ec_order.confirmed? %>
                    <%= link_to '取消', cancel_ec_order_path(ec_order), data: {confirm: '确认取消？'}, method: :put if ec_order.pending? %>
                    <%#= link_to '退款', refund_ec_order_path(ec_order), data: {confirm: '确认已退款？'}, method: :put if ec_order.refunding? %>
                    <%#= link_to "删除", ec_order_path(ec_order), method: :delete, data: {confirm: '确定删除吗？'} if ec_order.can_delete?(ec_order) %>
                  </td>
                </tr>
              <% end %>
              <% if @ec_orders.count == 0 %>
                <tr>
                  <td colspan="16"><span class="green">无记录</span></td>
                </tr>
              <% end %>
            </tboday>
          </table>
          <%= paginate @ec_orders %>
        </div>

      </div>
    </div>

  </div>
<% end %>
