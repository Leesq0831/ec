<style type="text/css">
  .select-ec {
    width: 150px;
  }
</style>
<% content_for :main_content do %>
  <div class="main-content ">
    <div class="breadcrumbs" id="breadcrumbs">
      <ul class="breadcrumb">
        <%= render 'partials/home' %>
        <li><%= link_to '餐厅管理',ec_shops_path %></li>
        <li><%= link_to '搭配推荐', ec_shop_recommends_path %></li>
        <li><%= link_to '商品设置', 'javascript:;' %></li>
      </ul>
    </div>

    <div class="page-content">
      <div class="col-md-12 margin-top-10">
        <div class="form-group">
          <label class="control-label">餐厅名称: <span><%= @ec_shop_recommend.ec_shop.try(:name) %></span></label>
        </div>

        <div class="form-group">
          <label class="control-label">推荐名称: <span><%= @ec_shop_recommend.title %></span></label>
        </div>
        <div class="form-group">
          <label class="control-label">推荐主图: <span><img src="<%= @ec_shop_recommend.format_pic_url(width: 200, height: 200) %>" width="100" class="margin-right-10"></span></label>
        </div>

        <%= form_tag delete_ec_shop_recommends_path, method: :post do %>
          <div class="form-group">
            <label class="control-label">搭配商品<span class="required-star">*</span> <small>选择3个商品</small></label>

            <table id="selected_products" class="table table-striped table-bordered table-hover dataTable ">
              <thead>
                <tr>
                  <th><input type='checkbox' class='checkbox toggle' style="display:inline;" onclick="affectAllChildren(this, $('#selected_products'));" /> 全选/反选</label></th>
                  <!-- <th>操作</th> -->
                  <th>图片</th>
                  <th>分类</th>
                  <th>名称</th>
                  <th>规格</th>
                  <th>价格</th>
                  <th>库存</th>
                  <th>状态</th>
                </tr>
              </thead>
              <tbody id="colleges_body">
                <% @ec_shop_recommend_details.each do |ec_shop_recommend_detail| %>
                  <% ec_item = ec_shop_recommend_detail.ec_item %>
                  <tr>
                    <td><%= check_box_tag 'ids[]', ec_shop_recommend_detail.id %></td>
                    <!-- <td><%= link_to '删除', del_ec_shop_recommend_path(ec_shop_recommend_detail), method: :post, data: { confirm: '确认要删除吗？' } %></td> -->
                    <td><img src="<%= ec_item.ec_product.try(:ec_picture).try(:format_pic_url, width: 100, height: 100) %>" width="50"></td>
                    <td><%= ec_item.ec_product.ec_category.name %></td>
                    <td><%= ec_item.ec_product.name %></td>
                    <td><%= ec_item.name %></td>
                    <td><%= ec_item.price %></td>
                    <td><%= ec_item.qty %></td>
                    <td><%= ec_item.status_name %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>

          <div class="form-group">
            <%= submit_tag '删除', class: "btn btn-sm btn-filter btn-primary"%>
          </div>
        <% end %>

        <div class="row margin-top-20">
          <%= form_for @search, url: ec_shop_recommend_path(@ec_shop_recommend), :html => { :method => :get } do |f| %>
            <div class="col-sm-12">
              <div class="col-md-2 row">
                <div class="input-group input-group-text">
                  <span class="input-group-addon">名称：</span>
                  <%= f.text_field :name_like, class: 'col-xs-12' %>
                </div>
              </div>

              <div class="col-md-2">
                <div class="input-group input-group-text">
                  <span class="input-group-addon">分类：</span>
                  <%= f.select :ec_product_ec_category_id_eq, EcCategory.product_category.pluck(:name, :id), {include_blank: '全部'}, class: 'col-xs-12' %>
                </div>
              </div>

              <div class="col-md-2">
                <button class="btn btn-primary btn-sm btn-filter">查询</button>
              </div>
            </div>
          <% end %>
        </div>

        <%= form_tag change_ec_shop_recommend_path(@ec_shop_recommend), method: :post do %>
          <div class="form-group margin-top-10">
            <table id="products" class="table table-striped table-bordered table-hover dataTable ">
              <thead>
                <tr>
                  <th><input type='checkbox' class='checkbox toggle' style="display:inline;" onclick="affectAllChildren(this, $('#products'));" /> 全选/反选</label></th>
                  <th>图片</th>
                  <th>分类</th>
                  <th>名称</th>
                  <th>规格</th>
                  <th>价格</th>
                  <th>库存</th>
                </tr>
              </thead>
              <tbody id="colleges_body">
                <%= hidden_field_tag 'ec_shop_recommend[ec_item_ids][]', '' %>
                <% @ec_items.each do |ec_item| %>
                  <tr>
                    <td>
                      <%= check_box_tag 'ec_shop_recommend[ec_item_ids][]', ec_item.id, @ec_shop_recommend.ec_items.include?(ec_item) %>
                    </td>
                    <td><img src="<%= ec_item.ec_product.try(:ec_picture).try(:format_pic_url, width: 100, height: 100) %>" width="50"></td>
                    <td><%= ec_item.ec_product.ec_category.name %></td>
                    <td><%= ec_item.ec_product.name %></td>
                    <td><%= ec_item.name %></td>
                    <td><%= ec_item.price %></td>
                    <td><%= ec_item.qty %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
            <%= paginate @ec_items %>
          </div>

          <div class="form-group">
            <%= submit_tag '提交', class: "btn btn-sm btn-filter btn-primary"%>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>

<script>
  function affectAllChildren(e, selected){
    if ($(e).prop('checked')) {
      $(this).attr('checked', true);
      selected.find(":checkbox:not(.toggle)").each(function (i, checkbox) {
        checkbox.checked = true;
      });
    }else{
      $(this).attr('checked', false);
      selected.find(":checkbox:not(.toggle)").each(function (i, checkbox) {
        checkbox.checked = false;
      });
    }
  };
</script>
