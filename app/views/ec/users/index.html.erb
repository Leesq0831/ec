<style type="text/css">
  .select-ec {
    width: 150px;
  }
</style>

<% content_for :main_content do %>
  <div class="main-content ">
    <div class="breadcrumbs" id="breadcrumbs">
      <ul class="breadcrumb">
        <%= render 'partials/home' %>
        <li><%= link_to '用户管理' %></li>
      </ul>
    </div>

    <div class="page-content">
      <div class="row">
        <div class=" col-md-12 ">
          <%= form_for @search, url: ec_users_path,  html: { method: :get } do |f| %>
            <div class="col-md-2">
              <div class="input-group input-group-sm input-group-text">
                <%= f.text_field :user_name_like, placeholder:"请输入用户姓名", class: 'col-xs-12' %>
              </div>
            </div>

            <div class="col-md-1">
              <div class="input-group input-group-sm input-group-text">
                <%= f.submit '查询', class: 'btn btn-sm btn-filter btn-primary' %>
              </div>
            </div>

            <div class="col-md-1">
              <div class="input-group input-group-sm input-group-text">
                <%#= link_to '导出', ec_users_path(:format => :xls, search: params[:search]) ,class: 'btn btn-sm btn-filter btn-primary' %>
              </div>
            </div> 
          <% end %>
        </div>
      </div>

      <div class=" col-md-12 margin-top-10">
        <table id="rolesTable" class="table table-striped table-bordered table-hover dataTable m">
          <thead>
            <tr>
              <th>姓名</th>
              <th>微信昵称</th>
              <th>微信头像</th>
              <th>性别</th>
              <th>联系电话</th>
              <th>收货地址</th>
              <th>订单总量</th>
              <th>订单总金额</th>
              <th>最后下单时间</th>
              <!-- <th>状态</th> -->
            </tr>
          </thead>
          <tboday>
            <% @users.each do |user| %>
              <tr>
                <td><%= user.name %></td>
                <td><%= user.wx_user.try(:nickname) %></td>
                <td><%= image_tag user.wx_user.headimgurl, size: '50x50' if user.wx_user.try(:headimgurl).present? %></td>
                <td><%= user.wx_user.try(:sex_name) %></td>
                <td><%= user.mobile %></td>
                <td><%= user.address %></td>
                <td><%= user.ec_orders.where('status > 0').count %></td>
                <td><%= user.ec_orders.where('status > 0').sum(:pay_amount) %></td>
                <th><%= user.ec_orders.where('status > 0').last.try(:created_at) %></th>
                <!-- <td><%= user.status_name %></td> -->
              </tr>
            <% end %>
            <% if @users.count == 0 %>
              <tr>
                <td colspan="9"><span class="green">无记录</span></td>
              </tr>
            <% end %>
          </tboday>
        </table>
        <%= paginate @users %>
      </div>
    </div>

  </div>
<% end %>
