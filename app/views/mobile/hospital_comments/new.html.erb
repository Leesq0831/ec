<% provide(:title, @hospital.name) %>
<section id="index">
	<header>
		<div class="wrap">
			<a href="<%= mobile_hospital_comments_url(id: @hospital_doctor.id) %>" class="ico-prev"><img src="/assets/mobile/whospital/ico-back.png"/></a>
			<h1>写评论</h1>
		</div>
	</header><!-- header end -->

	<div class="body">
		<div class="box-comment">
			<div class="comment-form">
				<div class="hd">
					<h2 class="ellipsis">发表评论</h2>
					<a class="ico ico-heart fr"><em><%= @comments.count %></em></a>
				</div>
				<div class="bd">
					<div class="fr">
						<%= form_for @comment, url: mobile_hospital_comments_url, method: :post do |f| %>
							<%= f.hidden_field :site_id %>
							<%= f.hidden_field :commentable_id %>
							<%= f.hidden_field :commentable_type %>
							<%= f.hidden_field :commenter_id %>
							<%= f.hidden_field :commenter_type %>
							<%= hidden_field_tag "id", @hospital_doctor.id  %>
							<div class="comment-input">
								<%= f.text_area :comment, :rows => 3,  :placeholder => "请输入您的评论", maxlength: 1000 %>
								<div class="bd-face">
									<!--<a class="ico icon-smile"></a>-->
									<span class="fr" id="limit_word_count">1000</span>
								</div>
							</div>
							<div class="comment-btn">
								<input type="submit" class="btn fw form-submit" value="发布"/>
							</div>
						<% end %>
					</div>
				</div>
			</div>
			<h3>热门评论</h3>
			<div class="comment-list">
			<% if @comments.count == 0 %>
				<div class="box-null">
					真遗憾，暂时没有评论哦！
				</div><!--box-null end-->
			<% else %>
				<% @comments.each do |comment| %>
				<div class="comment-li">
					<div class="fr">
						<b><%= comment.commenter.try(:name) %></b>
	          <span>
	            <i><%= date_format_full(comment.created_at.to_date) %></i>
	          </span>
						<p><%= comment.comment %></p>
					</div>
				</div><!--comment-li end-->
				<% end %>
			<% end %>
			</div><!--comment-list end-->
		</div><!-- box-comment end -->
	</div>
</section>

<% content_for :comment_js do %>
	<script>
		$(".btn").click(function(){
			if($("#comment_comment").val() == ''){
				alert("评论不能为空！");
				$("#comment_comment").focus();
				return false;
			}else{
				$("form").submit();
			}
		});

		$("#comment_comment").keydown(function(){
			var current_count = $(this).val().length;
			var ret = 1000 - current_count;
			$("#limit_word_count").text(ret);
		});
	</script>
<% end %>
